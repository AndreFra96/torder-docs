<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://example.com/ordini/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Ordini - T-Order Developers</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">T-Order Developers</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem active">
                                <a href="./" class="nav-link">Ordini</a>
                            </li>
                            <li class="navitem">
                                <a href="../rinnovi/" class="nav-link">Rinnovi</a>
                            </li>
                            <li class="navitem">
                                <a href="../integrazioni/" class="nav-link">Integrazioni</a>
                            </li>
                            <li class="navitem">
                                <a href="../esempi/" class="nav-link">Esempi</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" class="nav-link disabled">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../rinnovi/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#ordini" class="nav-link">Ordini</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#tabelle-coinvolte" class="nav-link">Tabelle coinvolte</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#informazioni-ordine" class="nav-link">Informazioni ordine</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#ciclo-dellordine" class="nav-link">Ciclo dell'ordine</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="ordini">Ordini</h1>
<p>Il concetto chiave di t-order sono gli ordini, un ordine rappresenta un singolo rapporto di vendita verso un cliente.</p>
<p>Ogni ordine viene generato come preventivo e segue una serie di passaggi prestabiliti che portano fino alla completa evasione, affiancando gli impiegati dei diversi settori nelle specifiche fasi che li coinvolgono.</p>
<p>Per convenzione all'interno della documentazione si utilizzerà il termine ordine per riferirsi ad un ordine in qualsiasi stato, nel caso in cui fosse necessario riferirsi ad uno specifico stato sarà scritto in maiuscolo ORDINE.</p>
<h2 id="tabelle-coinvolte">Tabelle coinvolte</h2>
<p>Gli ordini e le informazioni ad essi collegate sono salvate nelle seguenti tabelle:</p>
<ul>
<li>ordine &rarr; contiene tutti gli ordini</li>
<li>articolo_ordine &rarr; contiene tutti gli articoli di un ordine</li>
<li>attivazione_articolo_ordine &rarr; contiene le date di attivazione relative agli articoli ordine</li>
<li>matricola_articolo_ordine &rarr; contiene le matricole relative agli articoli ordine</li>
<li>articolo_cliente_ordine &rarr; contiene gli articoli già in possesso dal cliente inseriti all'interno dell'ordine per l'importazione in trace in fase di evasione</li>
</ul>
<h2 id="informazioni-ordine">Informazioni ordine</h2>
<p>Ad ogni ordine sono associate diverse informazioni, alcune salvate nella tabella ordine e altre salvate in tabelle secondarie.</p>
<h3 id="cliente">Cliente</h3>
<p>Ogni ordine deve essere associato ad un cliente, l'associazione con il cliente avviene tramite scrittura dell'id del cliente nel campo cliente della tabella ordine.</p>
<p>I clienti vengono sincronizzati bilateralmente con trace.</p>
<p>Il passaggio da trace a t-order avviene tramite scrittura nella tabella clienti, nel momento dell'inserimento trace compila il campo id_trace con un identificativo univoco relativo al cliente.</p>
<p>Il passaggio da t-order a trace avviene quando l'ordine si trova in fase ORDINE, prima di generare l'impegno infatti trace controlla se il cliente ha il campo trace_id a null e nel caso inserisce il cliente nel suo database e aggiorna il campo trace_id della tabella cliente con il nuovo id.</p>
<p>(Vedi documentazione sincronizzazioni per ulteriori informazioni)</p>
<h3 id="locale">Locale</h3>
<p>Ogni ordine può essere associato ad uno specifico locale di un cliente, l'associazione con il locale avviene tramite scrittura dell'id del locale nel campo locale della tabella ordine.</p>
<p>La sincronizzazione con trace avviene nello stesso modo in cui avviene la sincronizzazione dei clienti.</p>
<p>(Vedi documentazione sincronizzazioni per ulteriori informazioni)</p>
<h3 id="articoli-ordine">Articoli Ordine</h3>
<p>Ad ogni ordine sono associati una serie di articoli, salvati nella tabella articolo_ordine.</p>
<p>Ogni articolo_ordine possiede una serie di informazioni:</p>
<ul>
<li>ordine &rarr; campo di associazione con l'ordine, contiene l'id dell'ordine di appartenenza</li>
<li>articolo &rarr; campo di associazione con l'articolo, contiene l'id dell'articolo</li>
<li>quantità</li>
<li>prezzo &rarr; il prezzo di partenza può essere modificato rispetto al prezzo di base dell'articolo</li>
<li>sconto &rarr; sconto sull'articolo</li>
</ul>
<p><u>Ordini con canoni</u></p>
<p>Se il campo has_rid della tabella ordine è true significa che l'ordine in questione è un ordine con canone e gli unici articoli che possono essere associati sono gli articoli appartenenti ad un gruppo con mth_12 = 1 (mensili).</p>
<p>Questi ordini una volta evasi permetteranno di generare dei rinnovi mensili.</p>
<p><u>Sconto sul Totale</u></p>
<p>Oltre agli sconti effettuati sul singolo articolo è possibile effettuare uno sconto generale su tutto il carrello, questa informazione viene memorizzata tramite il campo totale della tabella ordine.</p>
<p><u>Matricole e Date di attivazione</u></p>
<p>Per ogni articolo ordine:</p>
<ul>
<li>l'inserimento della matricola è obbligatorio se l'articolo corrispondente all'articolo ordine ha need_serial = 1 oppure se ha need_serial_grenke = 1 e l'ordine ha grenke = 1</li>
</ul>
<p><code>need_serial == 1 || (need_serial_grenke == 1 &amp;&amp; grenke == 1);</code></p>
<ul>
<li>l'inserimento della data di attivazione è obbligatorio se l'articolo corrispondente è un articolo di tipo rinnovo (mth_1 = 1 o mth_12 = 1 o mth_24 = 1 o new_year = 1)</li>
</ul>
<p><code>mth_1 == 1 || mth_12 == 1 || mth_24 == 1 || new_year == 1;</code></p>
<p>Le matricole vengono salvate nella tabella matricola_articolo_ordine e le date di attivazione nella tabella attivazione_articolo_ordine.</p>
<p>Dato che la tabella articoli cliente prevede un campo quantità mentre la matricola o data di attivazione è da assegnare al singolo articolo le tabelle attivazione_articolo_ordine e matricola_articolo_ordine hanno un campo prg (intero progressivo), utilizzato per riferirsi ad uno spefico oggetto anche quando la quantità è maggiore di 1.</p>
<h3 id="fatturazione">Fatturazione</h3>
<p>All'interno dell'ordine è necessario inserire una serie di informazioni che saranno utilizzate per la generazione della fattura:</p>
<ul>
<li>Tipo di fatturazione:</li>
</ul>
<p>Per ogni ordine è necessario definire un tipo per la fatturazione, i tipi disponibili cambiano in funzione del campo has_rid (ordine con canoni) dell'ordine - se has_rid = 1: - Fatturazione Mensile - Fatturazione Trimestrale - Fatturazione Semestrale - se has_rid = 0: - Singola Fatturazione</p>
<ul>
<li>Fatturazione alternativa:</li>
</ul>
<p>Per ogni ordine è possibile definire un secondo cliente al quale intestare la fattura, l'impostazione di un cliente per la fatturazione alternativa avviene tramite scrittura nel campo cliente_fatt_alt dell'id del cliente alternativo.</p>
<ul>
<li>Grenke:</li>
</ul>
<p>Indica un ordine di tipo grenke, questo campo viene impostato a 1 automaticamente quando viene selezionato il cliente grenke.</p>
<p>Se questo campo è a 1 gli articoli inseriti nell'ordine con need_serial_grenke = 1 avranno bisogno della matricola</p>
<h3 id="acconto">Acconto</h3>
<p>Per ogni ordine è possibile associare un acconto, l'inserimento di un acconto comporta la creazione di un secondo ordine di acconto nel momento di passaggio dallo stato preventivo allo stato ORDINE.</p>
<p>L'inserimento dell'acconto avviene tramite scrittura dei campi down_payment (totale acconto) e down_payment_type (metodo di pagamento).</p>
<p>La creazione dell'acconto avviene quando down_payment è &gt; 0, in tal caso se down_payment_type non corrisponde ad un metodo di pagamento viene sollevato un errore.</p>
<p><u>L'ordine di acconto viene generato automaticamente nello stato evaso.</u></p>
<h3 id="pagamento">Pagamento</h3>
<p>E' necessario associare ad ogni ordine un metodo di pagamento.</p>
<p>L'associazione avviene tramite scrittura nel campo pagamento della tabella ordine dell'id del metodo di pagamento.</p>
<p><u>Attesa di pagamento</u>
<br>E' possibile bloccare il passaggio di stato di un ordine in attesa del pagamento impostando il campo wait_payment dell'ordine a 1.</p>
<h3 id="informazioni-tecniche">Informazioni tecniche</h3>
<p>E' possibile inserire delle informazioni del reparto tecnico all'interno dell'ordine:</p>
<ul>
<li>tecnico &rarr; l'assegnazione di un ordine ad un tecnico prevede l'invio di una mail al tecnico interessato</li>
<li>data_consegna</li>
<li>note_tecniche</li>
</ul>
<h3 id="articoli-cliente">Articoli cliente</h3>
<p>All'interno di un ordine è possibile inserire degli articoli che sono già in possesso del cliente per poter sincronizzare l'informazione con trace.
Questi articoli vengono trattati in maniera diversa rispetto agli articolo_ordine e vengono salvati in una tabella dedicata (articolo_cliente_ordine).</p>
<p>E' possibile inserire in questa tabella tutti gli articoli appartenenti ad un gruppo con aggiungi_a_cliente = true.</p>
<h3 id="allegati">Allegati</h3>
<p>E' possibile allegare ad un ordine diversi file, i file devono essere caricati tramite lo specifico enpoint.</p>
<h3 id="pdf">PDF</h3>
<p>E' disponibile uno specifico endpoint che resitituisce un file PDF con una rappresentazione dell'ordine.</p>
<h2 id="ciclo-dellordine">Ciclo dell'ordine</h2>
<h3 id="fasi">Fasi</h3>
<p>Ogni ordine segue un ciclo specifico che comprende 5 fasi:</p>
<ol>
<li>Preventivo
   <br> E' lo stato iniziale di ogni ordine e rappresenta il momento dell'offerta al cliente, permette l'inserimento di molte informazioni mantenendone la maggior parte non obbligatorie. In questo modo è possibile creare un preventivo iniziale con le informazioni in possesso per poi integrarle in seguito.</li>
<li>Ordine
   <br> E' il primo stato successivo alla conferma del preventivo, il passaggio a questo stato rappresenta il raggiunto accordo con il cliente sull'ordine e permette di procedere ai passaggi successivi.
   <br> Per effettuare il passaggio ad ordine è necessario inserire buona parte delle informazioni che erano facoltative in fase di preventivo.
   <br> Gli ordini in questo stato vengono letti dal programma di contabilità che genera l'impegno e modifica lo stato impostandolo ad impegno.</li>
<li>Impegno
   <br> Quando un ordine giunge in questo stato significa che è stato generato correttamente l'impegno in contabilità e, dopo i necessari controlli, è possibile passare allo stato lavorazione</li>
<li>Lavorazione
   <br> Lo stato in lavorazione indica che è in corso la fase di preparazione del materiale e di consegna al cliente.</li>
<li>Evaso
   <br> E' lo stato finale di un ordine, quando un ordine giunge in questo stato significa che il ciclo è completato e gli articoli inseriti possono essere sincronizzati con trace e letti dal programma di contabilità per procedere alla generazione della fattura.</li>
</ol>
<h3 id="passaggi-di-stato">Passaggi di stato</h3>
<p>Quando un ordine viene creato si trova in fase di preventivo, nel passaggio agli stati successivi vengono effettuate diverse operazioni che è possibile suddividere in 2 categorie: controlli e azioni.</p>
<p>I controlli e le azioni vengono effettuati prima del passaggio di stato tramite un middleware inserito nell'endpoint di modifica stato di un ordine.</p>
<p>Per ogni ordine viene controllato che lo stato di destinazione non sia uguale allo stato attuale e che sia compatibile con lo stato dell'ordine attuale.</p>
<p><u>Calcolo stati disponibili:</u></p>
<pre><code>switch (ordine.stato) {
  case 1:
    if (ordine.deleted)
      stati_disponibili = [
        { status_id: 0, status_loc_desc: &quot;CANCELLATO&quot;, active: true },
        { status_id: 1, status_loc_desc: &quot;ARCHIVIATO&quot;, active: false },
        { status_id: 2, status_loc_desc: &quot;PREVENTIVO&quot;, active: false },
      ];
    else
      stati_disponibili = [
        { status_id: 0, status_loc_desc: &quot;CANCELLATO&quot;, active: false },
        { status_id: 1, status_loc_desc: &quot;ARCHIVIATO&quot;, active: true },
        { status_id: 2, status_loc_desc: &quot;PREVENTIVO&quot;, active: false },
      ];
    break;
  case 2:
    stati_disponibili = [
      { status_id: 0, status_loc_desc: &quot;CANCELLATO&quot;, active: false },
      { status_id: 1, status_loc_desc: &quot;ARCHIVIATO&quot;, active: false },
      { status_id: 2, status_loc_desc: &quot;PREVENTIVO&quot;, active: true },
      { status_id: 3, status_loc_desc: &quot;ORDINE&quot;, active: false },
    ];
    break;
  case 3:
    stati_disponibili = [
      { status_id: 3, status_loc_desc: &quot;ORDINE&quot;, active: true },
    ];
    break;
  case 5:
    if (ordine.data_fatturazione == null)
      stati_disponibili = [
        { status_id: 5, status_loc_desc: &quot;IMPEGNO&quot;, active: true },
        { status_id: 6, status_loc_desc: &quot;LAVORAZIONE&quot;, active: false },
        { status_id: 0, status_loc_desc: &quot;CANCELLATO&quot;, active: false },
      ];
    else
      stati_disponibili = [
        { status_id: 5, status_loc_desc: &quot;IMPEGNO&quot;, active: true },
        { status_id: 6, status_loc_desc: &quot;LAVORAZIONE&quot;, active: false },
      ];
    break;
  case 6:
    if (ordine.data_fatturazione == null)
      stati_disponibili = [
        { status_id: 6, status_loc_desc: &quot;LAVORAZIONE&quot;, active: true },
        { status_id: 7, status_loc_desc: &quot;EVASO&quot;, active: false },
        { status_id: 0, status_loc_desc: &quot;CANCELLATO&quot;, active: false },
      ];
    else
      stati_disponibili = [
        { status_id: 6, status_loc_desc: &quot;LAVORAZIONE&quot;, active: true },
        { status_id: 7, status_loc_desc: &quot;EVASO&quot;, active: false },
      ];
    break;
  case 7:
    if (ordine.data_fatturazione == null)
      stati_disponibili = [
        { status_id: 7, status_loc_desc: &quot;EVASO&quot;, active: true },
        { status_id: 0, status_loc_desc: &quot;CANCELLATO&quot;, active: false },
      ];
    else
      stati_disponibili = [
        { status_id: 7, status_loc_desc: &quot;EVASO&quot;, active: true },
      ];
    break;
  default:
    stati_disponibili = [];
}
</code></pre>
<p><u> Controlli specifici per stato: </u></p>
<p>I controlli e le azioni effettuati in seguito dipendono dallo stato di destinazione dell'ordine, se i controlli o le azioni sollevano un errore il passaggio di stato non viene eseguito</p>
<ul>
<li>&rarr; Preventivo (2)</li>
<li>Azioni:<ul>
<li>Aggiorno la data dell'ordine impostando la data attuale</li>
</ul>
</li>
<li>&rarr; Ordine (3)</li>
<li>Controlli:<ul>
<li>Campi obbligatori locale (loc_desc,via,citta,prov,profilo_locale)</li>
<li>Campi obbligatori cliente (ragosc,via,cap,citta,provincia,piva)</li>
<li>IBAN obbligatorio se pagamento con sdd</li>
<li>Note tecniche obbligatorie in base agli articoli inseriti (se c'è almeno un articolo con order_note = 1 note_tecniche è obbligatorio)</li>
</ul>
</li>
<li>Azioni:<ul>
<li>Aggiorno la data dell'ordine impostando la data attuale</li>
<li>Generazione ordine di acconto (se down_payment &gt; 0)</li>
<li>Invio mail creazione ordine</li>
</ul>
</li>
<li>&rarr; Lavorazione (6)</li>
<li>Controlli:<ul>
<li>ordine non in attesa di pagamento (wait_payment)</li>
</ul>
</li>
<li>&rarr; Evaso (7)</li>
<li>Controlli:<ul>
<li>ordine non in attesa di pagamento (wait_payment)</li>
<li>sono state inserite le matricole e attivazioni necessarie</li>
<li>prg locale obbligatorio</li>
<li>id_trace cliente obbligatorio</li>
</ul>
</li>
<li>Azioni:<ul>
<li>Aggiorno la data_evasione dell'ordine con la data attuale</li>
<li>Eseguo import ordine in trace (compresi articoli cliente)</li>
</ul>
</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
